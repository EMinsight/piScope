import MDSplus
import threading
import os, binascii, pickle, numpy

host =  "localhost"
port =  10002
def client(ip, port, message):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((ip, port))
    try:
        print "requesting : ", message
        sock.sendall(message)
        rfile=sock.makefile('r')
        response=rfile.readline().strip()
        rfile.close()

        if (message[0]=='v' or
            message[0]=='f'):
           #print "received data len = ", len(response)
           # print type(binascii.a2b_hex(response))
           return pickle.loads(binascii.a2b_hex(response))
        else:
           #print "Received: "+str(response)
           return response
    finally:
        sock.close()

def open(experiment, shot, node):
    command = "c"+experiment+","+ str(shot)+","+str(node)
    return client(host, port, command)

def value(expr):
    command = "v"+expr
    return client(host, port, command)

def eval(experiment, shot, node, expr):
    command = "f"+experiment+","+ str(shot)+","+str(node)+","+str(expr)
    return client(host, port, command)
